<script type="text/javascript">
function sub(){
	
	 $("#add_form").submit();
 };
 $("#add_form").Validform({
		tiptype:3,
		datatype:{
			"phone":/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/
		 },
		callback:function(form){
			addPersonnel();
		}
	});
 
function addPersonnel(){
	var params=$("#add_form").serialize();
	 dialogBox(function(index){
		 $.post("${basePath}personnel/addPersonnel.htm",params,function(data){
			  layer.close(index);
				if(data.isOK == true){
					succInfo(function(){
						query();
					},"新增成功");
				}else{
					errorInfo(data.error);
				}
			});
	 },"是否确认添加员工");
	
}
function addRole(){
	dialogBoxOutId("#addrole_div");
}

function closeDiv(){
	   layer.closeAll();
}
$(":checkbox").change( function () {
	   var thisId=$(this).attr("id");
	   var parentId=$(this).attr("parentId");
	   var isCheck=$(this).attr("checked");
	   var children=$("#children_ul_"+thisId).children().children(":checkbox");
	   var parent=$("#"+parentId);
	   if(isCheck=="checked"){
		   parent.attr("checked","checked");
	   }
	   else{
		   var children2=$("#children_ul_"+parentId).children().children(":checked");
		   if(children2.size()<=0){
			   parent.attr("checked",false);
		   }
	   }
	   children.each(function(i){
		   var thisParentId=$(this).attr("parentId");
		   if(thisParentId==thisId){
			   if(isCheck=="checked"){
				   $(this).attr("checked","checked");
			   }
			   else{
				   $(this).attr("checked",false);
			   }
		   }
		});
	   
	});

function confim(){
	   var values = new Array();
	   $("input:checked").each(function(i){
		   values[i]=$(this).val()
	   });
	   $("input[name='functionIds']").val(values);
	   closeDiv();
}
</script>
<div class="heading fontYH f20">新增员工 </div>
        <div class="mainBox newMem">
        <form id="add_form" action="javascript:void(0);">
          <table border="0" cellspacing="0" cellpadding="0" class="tabList tabNews">
            <col width="15%" />
            <col width="85%" />
            <tr>
              <th>员工姓名</th>
              <td><input type="text" name="name" class="input input-name" title="请填写员工姓名" datatype="s1-32"  nullmsg="请输入联系人名称"/></td>
            </tr>
			<tr>
              <th>联系手机</th>
              <td><input type="text" name="phone" class="input input-phone" title="填写员工手机号码"  datatype="m" errormsg="请输入正确的手机号码格式" nullmsg="联系手机不能为空"/></td>
            </tr>
			<tr>
              <th>登录密码</th>
              <td><input type="text" name="password" class="input input-addname" title="填写登录密码"  datatype="*6-32" errormsg="密码不能少于6位" nullmsg="密码不能为空"/></td>
            </tr>
			<tr>
              <th>所属公司</th>
              <td>
               <select name="company" id="select4" >
              	<#list company as company><#if company.id==query.company>
				<option value="${company.getId()}" selected="selected">${company.getName()}</option>
				<#else>
				<option value="${company.getId()}">${company.getName()}</option>
				</#if></#list>
              </select>
              </td>
            </tr>
			<tr>
              <th>操作权限</th>
              <td>
              <div class="adminDrop dropMenu sltinput" onclick="addRole();"> <span>全部权限</span> <span class="icon"></span> </div>
              <input id="functionIds_hidden" type="hidden" name="functionIds" value="none" />
              </td>
            </tr>  
			<tr>
              <th>UnionID</th>
              <td><input type="text" name="unionId" class="input input-addname" title="填写UnionId" datatype="s1-128"  nullmsg="UnionId不能为空"/>
              &nbsp;&nbsp;</td>
			</tr>   
          </table>
          </form>
          <div class="buttonBox mb10 tc"><span onclick="sub();"><a href="javascript:void(0);" class="button button-orange mr15">确定</a></span><a href="javascript:query();" class="button button-gray">返回</a></div>
        </div>
	<div id="addrole_div" class="modal-wrap popDemo dropList" style="display: none;dwidth:590px;margin-left:-188px;margin-top:-4px;">
		     <div class="modal-header"><span class="close" onclick="closeDiv();">关闭</span></div>
		     <div class="modal-body dropBox">
		     <#list allFunction as function>
		     	<div class="item">
			     <span>
			      <#if function.function.id==1>
			     	<input id="${function.function.id}" type="checkbox" name="functionId" value="${function.function.id}" checked="checked" disabled="disabled">${function.function.title}
			     	<#else>
			     	<input id="${function.function.id}" type="checkbox" name="functionId" value="${function.function.id}">${function.function.title}
			       </#if>
			     </span>
			     <ul id="children_ul_${function.function.id}">
			      <#list function.children as children>
			       <#if children.id==3>
			     	<li><input id="${children.id}" parentId="${children.parentId}" type="checkbox" name="functionId" value="${children.id}" checked="checked" disabled="disabled">${children.title}</li>
			       <#else>
			       <li><input id="${children.id}" parentId="${children.parentId}" type="checkbox" name="functionId" value="${children.id}">${children.title}</li>
			        </#if>
			      </#list>
			     </ul>
		     	</div>
		     </#list>
		     <button class="popBtn" onclick="confim();">确认</button>
		     </div>
     </div>
